# 权限控制测试指南

## 问题修复

已修复的问题：
1. **模板条件判断错误**: 将 `v-if="isAdmin"` 改为 `v-if="isAdminComputed"`
2. **增加了详细的调试日志**: 便于追踪权限检查过程

## 测试步骤

### 1. 准备工作
- 打开浏览器开发者工具的控制台
- 确保可以看到 console.log 输出

### 2. 测试不同角色

#### 测试 user 角色：
1. 进入个人中心页面 (profile.vue)
2. 点击"切换角色(测试)"按钮，直到角色显示为"普通用户"
3. 进入设置页面
4. **预期结果**: 应该看不到"活动审核"和"用户认证"入口
5. 查看控制台，应该看到类似日志：
   ```
   === 设置页面权限检查开始 ===
   从存储获取的角色: user
   设置页面 - 当前用户角色: user
   设置页面 - isAdminComputed 计算结果: false
   设置页面 - 管理员功能可见性: false
   === 设置页面权限检查结束 ===
   ```

#### 测试 organizer 角色：
1. 进入个人中心页面
2. 点击"切换角色(测试)"按钮，直到角色显示为"认证用户"
3. 进入设置页面
4. **预期结果**: 应该看不到"活动审核"和"用户认证"入口
5. 控制台应该显示 isAdminComputed 为 false

#### 测试 admin 角色：
1. 进入个人中心页面
2. 点击"切换角色(测试)"按钮，直到角色显示为"管理员"
3. 进入设置页面
4. **预期结果**: 应该能看到"活动审核"和"用户认证"入口
5. 控制台应该显示 isAdminComputed 为 true

### 3. 验证权限控制

如果仍然能看到管理员功能，请检查：

1. **角色存储状态**:
   ```javascript
   // 在浏览器控制台执行
   console.log('当前存储的角色:', uni.getStorageSync('userRole'))
   ```

2. **强制设置角色**:
   ```javascript
   // 在浏览器控制台执行，强制设置为 user 角色
   uni.setStorageSync('userRole', 'user')

   // 然后刷新设置页面
   ```

3. **检查页面状态**:
   ```javascript
   // 在设置页面的控制台执行
   console.log('当前页面的 userRole:', this.$refs.settings?.userRole)
   ```

## 故障排除

如果问题仍然存在，可能的原因：

1. **缓存问题**: 尝试硬刷新页面 (Ctrl+F5)
2. **Vue响应式问题**: 可能需要强制重新渲染组件
3. **存储问题**: 检查是否有其他地方覆盖了用户角色

## 预期行为总结

| 角色 | 活动审核 | 用户认证 | 控制台 isAdminComputed |
|------|----------|----------|---------------------|
| user | ❌ 隐藏 | ❌ 隐藏 | false |
| organizer | ❌ 隐藏 | ❌ 隐藏 | false |
| admin | ✅ 可见 | ✅ 可见 | true |