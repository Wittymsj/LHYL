# 个人中心页面权限控制测试指南

## 修改内容

已修改 profile.vue 的快捷操作权限控制：

### 1. 基于用户角色的权限控制
- **user角色**: 只能看到"认证申请"按钮
- **organizer角色**: 只能看到"发布活动"按钮
- **admin角色**: 只能看到"发布活动"按钮

### 2. 双重验证机制
- **UI层控制**: 使用 `v-if` 条件渲染按钮
- **运行时验证**: 点击时再次验证用户权限

## 测试步骤

### 1. 准备工作
- 打开浏览器开发者工具的控制台
- 确保可以看到 console.log 输出

### 2. 测试不同角色

#### 测试 user 角色：
1. 进入个人中心页面
2. 点击"切换角色(测试)"按钮，直到角色显示为"普通用户"
3. **预期结果**:
   - ✅ 应该看到"认证申请"按钮
   - ❌ 不应该看到"发布活动"按钮
4. 点击"认证申请"按钮
   - **预期结果**: 跳转到主办方认证页面
5. 查看控制台，应该看到类似日志：
   ```
   === 个人中心页面权限检查开始 ===
   从存储获取的角色: user
   个人中心 - 当前用户角色: user
   个人中心 - 发布活动可见性: false
   个人中心 - 认证申请可见性: true
   === 个人中心页面权限检查结束 ===
   ```

#### 测试 organizer 角色：
1. 进入个人中心页面
2. 点击"切换角色(测试)"按钮，直到角色显示为"认证用户"
3. **预期结果**:
   - ✅ 应该看到"发布活动"按钮
   - ❌ 不应该看到"认证申请"按钮
4. 点击"发布活动"按钮
   - **预期结果**: 跳转到活动发布页面
5. 控制台应该显示发布活动可见性为 true

#### 测试 admin 角色：
1. 进入个人中心页面
2. 点击"切换角色(测试)"按钮，直到角色显示为"管理员"
3. **预期结果**:
   - ✅ 应该看到"发布活动"按钮
   - ❌ 不应该看到"认证申请"按钮
4. 点击"发布活动"按钮
   - **预期结果**: 跳转到活动发布页面

### 3. 验证权限控制

如果仍然看到不正确的按钮，请检查：

1. **角色存储状态**:
   ```javascript
   // 在浏览器控制台执行
   console.log('当前存储的角色:', uni.getStorageSync('userRole'))
   ```

2. **强制设置角色**:
   ```javascript
   // 在浏览器控制台执行，强制设置为 user 角色
   uni.setStorageSync('userRole', 'user')

   // 然后刷新个人中心页面
   ```

## 权限逻辑总结

| 角色 | 认证申请按钮 | 发布活动按钮 | 行为 |
|------|-------------|-------------|------|
| user | ✅ 可见 | ❌ 隐藏 | 点击跳转到认证页面 |
| organizer | ❌ 隐藏 | ✅ 可见 | 点击跳转到发布活动页面 |
| admin | ❌ 隐藏 | ✅ 可见 | 点击跳转到发布活动页面 |

## 安全机制

1. **UI层隐藏**: 使用 `v-if` 确保只有目标角色能看到相应按钮
2. **运行时验证**: 点击时再次验证角色，防止绕过UI层
3. **详细日志**: 所有权限检查都有控制台输出便于调试
4. **默认安全**: 出错时默认为 user 角色（最小权限原则）